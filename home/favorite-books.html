
<!DOCTYPE html>
<html ng-app="MyApp">

<head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    
    <script>
        angular.module("MyApp", [])
            .controller("myCtrl2", function ($scope, $http) {
                $scope.wait =  true;
                $scope.get_favorites = function () {
                    $http.get('/books/get_favorites').success(function (data) {
                        if (data.result == 'Success') {
                            $scope.favorites = data.data;
                            $scope.wait =  false;
                        } else {
                            $scope.favorites = null;
                            $scope.wait =  false;
                        }
                    }).error(function (data, status) {
                        $scope.wait =  false;
                        console.log('Error')
                    });
                };


                 $scope.remove_from_favorite = function (id) {
                    var params = {
                        'bookId': id,
                    }
                    $http.post('/books/remove_from_favorite', params).success(function (data) {
                        if (data.result == 'Success') {
                            console.log(data)
                            $scope.favorites = data.data;
                            $scope.wait = false;
                        } else {
                            $scope.wait = false;
                        }
                    }).error(function (data, status) {
                        $scope.wait = false;
                        console.log('Error')
                    });
                };

            });
    </script>
</head>
<div ng-controller="myCtrl2" ng-init="get_favorites()">
    <form class="col-lg-6 col-lg-6 col-lg-offset-3 col-lg-offset-3" ng-submit="sendMail();">
        <br>
        <a type="submit" class="btn btn-primary btn-sm" href="/auth/google-books">Back</a>
        <br>
        <div class="text-center text-uppercase">
            <h3>Your favorite books</h3>
        </div>
        <h4 ng-show="wait">Please wait.....</h4>
        <br>
        <div ng-show="favorites.length == 0" class="text-center">
            <h4 style="color: red">No books found!</h4>
        </div>
        <table ng-show="!wait && favorites.length != 0" class="table table-striped table-bordered">
            <thead style="border:2px solid #1E90FF;">
                <tr class="info">
                    <th scope="col">Sl. No.</th>
                    <th scope="col">Tite</th>
                    <th scope="col">Authors</th>
                    <th scope="col">Published Date</th>
                    <th scope="col">Publisher</th>
                    <th scope="col">Image</th>
                    <th scope="col">Action</th>
                 </tr>
            </thead>
            <tbody >
                  <tr  scope="row" ng-repeat = "data in favorites">
                    <td ng-bind="$index+1+indexIncrement"></td>
                    <td ng-bind="data.title"></td>
                    <td ng-bind="data.author"></td>
                    <td ng-bind="data.published_date"></td>
                    <td ng-bind="data.publisher"></td>
                    <td><img ng-src="{{data.image_url}}"></td>
                    <td>
                            <button type="button" class="btn btn-warning btn" ng-click="remove_from_favorite(data.bookId)" title="Remove from favorite">
                                    <i class="glyphicon glyphicon-trash"></i> Remove</button>
                    </td>
                </tr>
            </tbody>
       </table>
    </form>
</div>
</body>

</html>